'use client'

import React, { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { authUtils } from '@/lib/fetchData'
import DashboardLayout from '@/components/layout/DashboardLayout'
import ContentLoadingSpinner from '@/components/loading/ContentLoadingSpinner'
import { AddressSelector } from '@/components/AddressSelector'
import EditUserModal from '@/components/EditUserModal'
import { Eye, EyeOff } from 'lucide-react'

export default function UserManagement() {
    const router = useRouter()
    const [user, setUser] = useState(null)
    const [loading, setLoading] = useState(true)

    // Stats ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    const [stats, setStats] = useState({
        totalUsers: 0,
        regularUsers: 0,
        officers: 0,
        executives: 0,
        admins: 0
    })
    const [statsLoading, setStatsLoading] = useState(false)

    // User lists ‡πÅ‡∏•‡∏∞ tab management
    const [users, setUsers] = useState([])
    const [filteredUsers, setFilteredUsers] = useState([])
    const [usersLoading, setUsersLoading] = useState(false)
    const [activeTab, setActiveTab] = useState('all')

    // Pagination states
    const [currentPage, setCurrentPage] = useState(1)
    const [usersPerPage] = useState(10) // ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà 10 ‡∏Ñ‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤

    // Modal states
    const [showAddModal, setShowAddModal] = useState(false)
    const [showEditModal, setShowEditModal] = useState(false)
    const [editingUser, setEditingUser] = useState(null)

    useEffect(() => {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ login - ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡πÉ‡∏´‡πâ client-side render ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
        if (typeof window === 'undefined') return

        const initializeAuth = async () => {
            const [userData, token] = await Promise.all([
                Promise.resolve(authUtils.getUserWithRole()),
                Promise.resolve(authUtils.getToken()),
                new Promise(resolve => setTimeout(resolve, 5))
            ])

            console.log('UserManagement - user data:', userData)

            if (!token || !userData) {
                router.push('/login')
                return
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö role - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            if (userData.role !== 'admin') {
                router.push('/dashboard/' + userData.role)
                return
            }

            setUser(userData)
            setLoading(false)
        }

        initializeAuth()
    }, [router])

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î statistics
    const loadStats = async () => {
        console.log('üöÄ [loadStats] ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• admin stats')
        setStatsLoading(true)

        try {
            const token = authUtils.getToken()
            if (!token) return

            const url = 'http://localhost:8000/api/protected/admin/stats'
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })

            if (response.ok) {
                const data = await response.json()
                if (data.success && data.stats) {
                    setStats({
                        totalUsers: data.stats.total || 0,
                        regularUsers: data.stats.users || 0,
                        officers: data.stats.officers || 0,
                        executives: data.stats.executives || 0,
                        admins: data.stats.admins || 0
                    })
                }
            }
        } catch (error) {
            console.error('üí• [loadStats] Error loading admin stats:', error)
        } finally {
            setStatsLoading(false)
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const loadUsers = async () => {
        console.log('üë• [loadUsers] ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')
        setUsersLoading(true)

        try {
            const token = authUtils.getToken()
            if (!token) return

            const url = 'http://localhost:8000/api/protected/admin/users'
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })

            console.log('üì° [loadUsers] Response status:', response.status)
            console.log('üì° [loadUsers] Response ok:', response.ok)

            if (response.ok) {
                const data = await response.json()
                console.log('‚úÖ [loadUsers] API Response data:', data)

                if (data.success && data.data) {
                    console.log('üìä [loadUsers] Setting users:', data.data.length, 'users')
                    // Debug: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• profile_image ‡πÅ‡∏•‡∏∞ IDs
                    data.data.forEach((user, index) => {
                        const userId = user.user_id || user.officer_id || user.executive_id || user.admin_id
                        const hasProfileImage = user.profile_image ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ'
                        const profileURL = user.profile_image ? `http://localhost:8000/api/upload/profile-image/${userId}/${user.role}` : '‡πÑ‡∏°‡πà‡∏°‡∏µ'
                        console.log(`üñºÔ∏è [loadUsers] User ${index + 1}: ${user.first_name} ${user.last_name} - ID: ${userId}, Role: ${user.role}, Profile: ${hasProfileImage}, URL: ${profileURL}`)
                    })
                    setUsers(data.data)
                    filterUsers('all', data.data)
                } else {
                    console.log('‚ö†Ô∏è [loadUsers] API success false ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ data:', data)
                }
            } else {
                const errorText = await response.text()
                console.log('‚ùå [loadUsers] Response not ok:', response.status, errorText)
            }
        } catch (error) {
            console.error('üí• [loadUsers] Error loading users:', error)
        } finally {
            setUsersLoading(false)
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏° tab
    const filterUsers = (tab, userList = users) => {
        let filtered = []

        switch (tab) {
            case 'all':
                filtered = userList
                break
            case 'users':
                filtered = userList.filter(u => u.role === 'user')
                break
            case 'officers':
                filtered = userList.filter(u => u.role === 'officer')
                break
            case 'executives':
                filtered = userList.filter(u => u.role === 'executive')
                break
            case 'admins':
                filtered = userList.filter(u => u.role === 'admin')
                break
            default:
                filtered = userList
        }

        setFilteredUsers(filtered)
        setActiveTab(tab)
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠ user ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß
    useEffect(() => {
        if (user && user.role === 'admin') {
            loadStats()
            loadUsers()
        }
    }, [user])

    // Handle tab change
    const handleTabChange = (tab) => {
        filterUsers(tab)
        setCurrentPage(1) // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ 1 ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô tab
    }

    // Pagination functions
    const getCurrentPageUsers = () => {
        const indexOfLastUser = currentPage * usersPerPage
        const indexOfFirstUser = indexOfLastUser - usersPerPage
        return filteredUsers.slice(indexOfFirstUser, indexOfLastUser)
    }

    const getTotalPages = () => {
        return Math.ceil(filteredUsers.length / usersPerPage)
    }

    const handlePageChange = (pageNumber) => {
        setCurrentPage(pageNumber)
    }

    // Handle edit user
    const handleEditUser = (userData) => {
        console.log('‚úèÔ∏è [handleEditUser] Clicked edit for user:', userData)
        console.log('‚úèÔ∏è [handleEditUser] User data keys:', Object.keys(userData))
        console.log('‚úèÔ∏è [handleEditUser] User data values:', {
            first_name: userData.first_name,
            last_name: userData.last_name,
            email: userData.email,
            citizen_id: userData.citizen_id,
            position: userData.position,
            department: userData.department,
            role: userData.role
        })

        setEditingUser(userData)
        setShowEditModal(true)
    }

    // Handle delete user - ‡πÅ‡∏™‡∏î‡∏á confirmation modal ‡∏™‡∏ß‡∏¢‡πÜ
    const handleDeleteUser = (userId, userRole, userData) => {
        showDeleteConfirmation(userId, userRole, userData)
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏à‡∏£‡∏¥‡∏á - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô global ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ modal ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ
    window.confirmDeleteUser = async (userId, userRole) => {
        try {
            const token = authUtils.getToken()
            const response = await fetch(`http://localhost:8000/api/protected/admin/users/${userId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ role: userRole })
            })

            if (response.ok) {
                showDeleteSuccessModal()
                // Reload data
                loadStats()
                loadUsers()
            } else {
                showErrorModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ')
            }
        } catch (error) {
            console.error('Error deleting user:', error)
            showErrorModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ')
        }
    }

    console.log('üé® [UserManagement] Render - loading:', loading, 'user:', !!user)

    if (loading) {
        return (
            <DashboardLayout user={user}>
                <ContentLoadingSpinner message="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ..." />
            </DashboardLayout>
        )
    }

    if (!user) {
        return null // ‡∏à‡∏∞ redirect ‡πÑ‡∏õ login ‡πÅ‡∏•‡πâ‡∏ß
    }

    return (
        <DashboardLayout user={user}>
            <div className="space-y-6">
                {/* Header */}
                <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white">
                    <h1 className="text-2xl lg:text-3xl font-bold mb-2">
                        üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    </h1>
                    <p className="text-indigo-100 text-sm lg:text-lg">
                        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á - ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏£‡∏≤‡∏ä‡∏†‡∏±‡∏è‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°
                    </p>
                </div>

                {/* Statistics Cards */}
                <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-6">
                    {/* Card 1: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */}
                    <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p className="text-2xl font-bold text-gray-900">
                                    {statsLoading ? '...' : stats.totalUsers.toLocaleString()}
                                </p>
                            </div>
                            <div className="text-3xl text-blue-500">üë•</div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2">‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</p>
                    </div>

                    {/* Card 2: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */}
                    <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</p>
                                <p className="text-2xl font-bold text-gray-900">
                                    {statsLoading ? '...' : stats.regularUsers.toLocaleString()}
                                </p>
                            </div>
                            <div className="text-3xl text-green-500">üë§</div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2">User ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>

                    {/* Card 3: ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà */}
                    <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
                                <p className="text-2xl font-bold text-gray-900">
                                    {statsLoading ? '...' : stats.officers.toLocaleString()}
                                </p>
                            </div>
                            <div className="text-3xl text-yellow-500">üëÆ</div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2">Officer ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>

                    {/* Card 4: ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ */}
                    <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</p>
                                <p className="text-2xl font-bold text-gray-900">
                                    {statsLoading ? '...' : stats.executives.toLocaleString()}
                                </p>
                            </div>
                            <div className="text-3xl text-purple-500">üéØ</div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2">Executive ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>

                    {/* Card 5: ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö */}
                    <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm font-medium text-gray-600">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                                <p className="text-2xl font-bold text-gray-900">
                                    {statsLoading ? '...' : stats.admins.toLocaleString()}
                                </p>
                            </div>
                            <div className="text-3xl text-red-500">üëë</div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2">Admin ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>

                {/* User Management Section */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                    {/* Header with Add Button */}
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-semibold text-gray-800">
                            üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                        </h2>
                        <button
                            onClick={() => setShowAddModal(true)}
                            className="bg-sky-400 hover:bg-sky-400 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                        >
                            <span className="text-lg">‚ûï</span>
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                        </button>
                    </div>

                    {/* Tabs */}
                    <div className="flex flex-wrap gap-2 mb-6 border-b border-gray-200">
                        {[
                            { key: 'all', label: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', count: stats.totalUsers },
                            { key: 'users', label: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', count: stats.regularUsers },
                            { key: 'officers', label: '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà', count: stats.officers },
                            { key: 'executives', label: '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', count: stats.executives },
                            { key: 'admins', label: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', count: stats.admins }
                        ].map((tab) => (
                            <button
                                key={tab.key}
                                onClick={() => handleTabChange(tab.key)}
                                className={`px-4 py-2 rounded-t-lg font-medium transition-colors ${activeTab === tab.key
                                    ? 'bg-blue-50 text-blue-700 border-b-2 border-blue-700'
                                    : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'
                                    }`}
                            >
                                {tab.label} ({statsLoading ? '...' : tab.count})
                            </button>
                        ))}
                    </div>

                    {/* User List */}
                    {usersLoading ? (
                        <div className="flex items-center justify-center py-12">
                            <div className="text-center">
                                <div className="animate-spin rounded-full h-8 w-8 border-4 border-gray-200 border-t-blue-600 mx-auto mb-4"></div>
                                <p className="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...</p>
                            </div>
                        </div>
                    ) : filteredUsers.length > 0 ? (
                        <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
                                        </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£
                                        </th>
                                        <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                                        </th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {getCurrentPageUsers().map((userData, index) => (
                                        <tr key={index} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="flex items-center">
                                                    <div className="flex-shrink-0 h-10 w-10">
                                                        {userData.profile_image ? (
                                                            <img
                                                                className="h-10 w-10 rounded-full object-cover border-2 border-gray-200"
                                                                src={`http://localhost:8000/api/upload/profile-image/${userData.user_id || userData.officer_id || userData.executive_id || userData.admin_id}/${userData.role}?t=${Date.now()}`}
                                                                alt={`${userData.first_name} ${userData.last_name}`}
                                                                onError={(e) => {
                                                                    e.target.style.display = 'none'
                                                                    e.target.nextElementSibling.style.display = 'flex'
                                                                }}
                                                            />
                                                        ) : null}
                                                        <div
                                                            className={`h-10 w-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center ${userData.profile_image ? 'hidden' : 'flex'}`}
                                                            style={{ display: userData.profile_image ? 'none' : 'flex' }}
                                                        >
                                                            <span className="text-sm font-semibold text-white">
                                                                {userData.first_name?.charAt(0)}{userData.last_name?.charAt(0)}
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div className="ml-4">
                                                        <div className="text-sm font-medium text-gray-900">
                                                            {userData.first_name} {userData.last_name}
                                                        </div>
                                                        <div className="text-sm text-gray-500">
                                                            {userData.email}
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="text-sm text-gray-900">
                                                    {userData.position || '-'}
                                                </div>
                                                <div className="text-sm text-gray-500">
                                                    {userData.department || '-'}
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${userData.role === 'admin' ? 'bg-red-100 text-red-800' :
                                                    userData.role === 'executive' ? 'bg-purple-100 text-purple-800' :
                                                        userData.role === 'officer' ? 'bg-yellow-100 text-yellow-800' :
                                                            'bg-green-100 text-green-800'
                                                    }`}>
                                                    {userData.role === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' :
                                                        userData.role === 'executive' ? '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£' :
                                                            userData.role === 'officer' ? '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà' :
                                                                '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}
                                                </span>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {new Date(userData.created_at).toLocaleDateString('th-TH')}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <button
                                                    onClick={() => handleEditUser(userData)}
                                                    className="text-blue-600 hover:text-blue-900 mr-3"
                                                >
                                                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteUser(userData.user_id || userData.officer_id || userData.executive_id || userData.admin_id, userData.role, userData)}
                                                    className="text-red-600 hover:text-red-900"
                                                >
                                                    üóëÔ∏è ‡∏•‡∏ö
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    ) : (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">üë•</div>
                            <h4 className="text-lg font-medium text-gray-700 mb-2">
                                ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                            </h4>
                            <p className="text-gray-600">
                                ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                            </p>
                        </div>
                    )}

                    {/* Pagination Controls */}
                    {filteredUsers.length > 0 && (
                        <div className="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-b-lg">
                            <div className="flex-1 flex justify-between sm:hidden">
                                {/* Mobile pagination */}
                                <button
                                    onClick={() => handlePageChange(currentPage - 1)}
                                    disabled={currentPage === 1}
                                    className={`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${currentPage === 1
                                        ? 'text-gray-400 bg-gray-100 cursor-not-allowed'
                                        : 'text-gray-700 bg-white hover:bg-gray-50'
                                        }`}
                                >
                                    ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                                </button>
                                <button
                                    onClick={() => handlePageChange(currentPage + 1)}
                                    disabled={currentPage === getTotalPages()}
                                    className={`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${currentPage === getTotalPages()
                                        ? 'text-gray-400 bg-gray-100 cursor-not-allowed'
                                        : 'text-gray-700 bg-white hover:bg-gray-50'
                                        }`}
                                >
                                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                                </button>
                            </div>

                            <div className="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                <div>
                                    <p className="text-sm text-gray-700">
                                        ‡πÅ‡∏™‡∏î‡∏á{' '}
                                        <span className="font-medium">{((currentPage - 1) * usersPerPage) + 1}</span>
                                        {' '}‡∏ñ‡∏∂‡∏á{' '}
                                        <span className="font-medium">
                                            {Math.min(currentPage * usersPerPage, filteredUsers.length)}
                                        </span>
                                        {' '}‡∏à‡∏≤‡∏Å{' '}
                                        <span className="font-medium">{filteredUsers.length}</span>
                                        {' '}‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                                    </p>
                                </div>
                                <div>
                                    <nav className="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                        {/* Previous button */}
                                        <button
                                            onClick={() => handlePageChange(currentPage - 1)}
                                            disabled={currentPage === 1}
                                            className={`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 text-sm font-medium ${currentPage === 1
                                                ? 'text-gray-400 bg-gray-100 cursor-not-allowed'
                                                : 'text-gray-500 bg-white hover:bg-gray-50'
                                                }`}
                                        >
                                            <span className="sr-only">Previous</span>
                                            <svg className="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" />
                                            </svg>
                                        </button>

                                        {/* Page numbers */}
                                        {Array.from({ length: getTotalPages() }, (_, i) => i + 1).map((page) => (
                                            <button
                                                key={page}
                                                onClick={() => handlePageChange(page)}
                                                className={`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${page === currentPage
                                                    ? 'z-10 bg-blue-50 border-blue-500 text-blue-600'
                                                    : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50'
                                                    }`}
                                            >
                                                {page}
                                            </button>
                                        ))}

                                        {/* Next button */}
                                        <button
                                            onClick={() => handlePageChange(currentPage + 1)}
                                            disabled={currentPage === getTotalPages()}
                                            className={`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 text-sm font-medium ${currentPage === getTotalPages()
                                                ? 'text-gray-400 bg-gray-100 cursor-not-allowed'
                                                : 'text-gray-500 bg-white hover:bg-gray-50'
                                                }`}
                                        >
                                            <span className="sr-only">Next</span>
                                            <svg className="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
                                            </svg>
                                        </button>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            </div>

            {/* Add User Modal */}
            {showAddModal && (
                <AddUserModal
                    isOpen={showAddModal}
                    onClose={() => setShowAddModal(false)}
                    onSuccess={() => {
                        loadStats()
                        loadUsers()
                    }}
                />
            )}

            {/* Edit User Modal */}
            {showEditModal && editingUser && (
                <>
                    {console.log('üöÄ [Page] Rendering EditUserModal with data:', editingUser)}
                    <EditUserModal
                        isOpen={showEditModal}
                        onClose={() => {
                            setShowEditModal(false)
                            setEditingUser(null)
                        }}
                        userData={editingUser}
                        onSuccess={() => {
                            loadStats()
                            loadUsers()
                        }}
                    />
                </>
            )}
        </DashboardLayout>
    )
}

// Perfect Success Alert - ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏û‡∏≠‡∏î‡∏µ! ‚ú®
const showSuccessModal = () => {
    const modal = document.createElement('div')
    modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in'
    modal.innerHTML = `
    <div class="bg-white rounded-2xl shadow-2xl w-96 mx-4 animate-success-bounce">
      <div class="px-8 py-8 text-center">
        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-check-icon">
          <svg class="w-8 h-8 text-white animate-check-draw" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-800 mb-6 animate-fade-up-text">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
        <button onclick="this.closest('.fixed').remove()" class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 animate-fade-up-button hover:scale-105 transform">
          <span class="flex items-center justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!
          </span>
        </button>
      </div>
    </div>
  `
    document.body.appendChild(modal)

    // Auto remove after 3 seconds
    setTimeout(() => {
        if (modal.parentNode) {
            modal.style.animation = 'fade-out 0.3s ease-out forwards'
            setTimeout(() => modal.remove(), 300)
        }
    }, 3000)
}

const showErrorModal = (title, message) => {
    const modal = document.createElement('div')
    modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in'
    modal.innerHTML = `
    <div class="bg-white rounded-2xl shadow-2xl max-w-md mx-4 animate-error-shake">
      <div class="bg-gradient-to-r from-red-500 to-pink-600 text-white px-6 py-4 rounded-t-2xl">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </div>
          <div>
            <h3 class="text-xl font-bold">${title}</h3>
          </div>
        </div>
      </div>
      <div class="px-6 py-6">
        <p class="text-gray-700 text-base leading-relaxed mb-4">${message}</p>
        <div class="flex justify-center">
          <button onclick="this.closest('.fixed').remove()" class="bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-6 py-2.5 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md">
            ‡∏ï‡∏Å‡∏•‡∏á
          </button>
        </div>
      </div>
    </div>
  `
    document.body.appendChild(modal)

    // Auto remove after 4 seconds
    setTimeout(() => {
        if (modal.parentNode) {
            modal.style.animation = 'fade-out 0.3s ease-out forwards'
            setTimeout(() => modal.remove(), 300)
        }
    }, 4000)
}

// Beautiful Delete Confirmation Modal - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡πÜ! üî•
const showDeleteConfirmation = (userId, userRole, userData) => {
    const modal = document.createElement('div')
    modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-md animate-fade-in'
    modal.innerHTML = `
    <div class="bg-white rounded-3xl shadow-2xl w-[480px] mx-4 animate-success-bounce border-2 border-red-100">
      <div class="relative overflow-hidden rounded-t-3xl bg-gradient-to-br from-red-50 via-pink-50 to-red-100 px-8 py-8">
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-red-200/30 to-pink-300/20 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-pink-200/20 to-red-200/30 rounded-full translate-y-12 -translate-x-12"></div>
        
        <div class="relative text-center">
          <div class="w-20 h-20 bg-gradient-to-br from-red-400 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse shadow-lg">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-gray-800 mb-3">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</h3>
          <p class="text-red-600 font-medium text-lg mb-2">‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</p>
          <p class="text-xl font-semibold text-gray-700">"${userData.first_name} ${userData.last_name}"</p>
          <p class="text-sm text-gray-500 mt-2">‡∏´‡∏≤‡∏Å‡∏Å‡∏î‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</p>
        </div>
      </div>
      
      <div class="px-8 py-6">
        <div class="flex gap-4">
          <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold transition-all duration-200 transform hover:scale-105">
            <span class="flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </span>
          </button>
          <button onclick="confirmDeleteUser(${userId}, '${userRole}'); this.closest('.fixed').remove()" class="flex-1 bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg">
            <span class="flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
              ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
            </span>
          </button>
        </div>
      </div>
    </div>
  `
    document.body.appendChild(modal)
}

// Beautiful Delete Success Modal - ‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚ú®
const showDeleteSuccessModal = () => {
    const modal = document.createElement('div')
    modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in'
    modal.innerHTML = `
    <div class="bg-white rounded-2xl shadow-2xl w-96 mx-4 animate-success-bounce">
      <div class="px-8 py-8 text-center">
        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-check-icon">
          <svg class="w-8 h-8 text-white animate-check-draw" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-800 mb-6 animate-fade-up-text">‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ</h3>
        <button onclick="this.closest('.fixed').remove()" class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 animate-fade-up-button hover:scale-105 transform">
          <span class="flex items-center justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!
          </span>
        </button>
      </div>
    </div>
  `
    document.body.appendChild(modal)

    // Auto remove after 3 seconds
    setTimeout(() => {
        if (modal.parentNode) {
            modal.style.animation = 'fade-out 0.3s ease-out forwards'
            setTimeout(() => modal.remove(), 300)
        }
    }, 3000)
}

// Add User Modal Component
function AddUserModal({ isOpen, onClose, onSuccess }) {
    const [formData, setFormData] = useState({
        first_name: '',
        last_name: '',
        email: '',
        password: '',
        confirmPassword: '',
        citizen_id: '',
        zip_code: '',
        position: '',
        department: '',
        role: 'user', // default role
        // Address fields
        address: {
            province: null,
            district: null,
            subdistrict: null,
        }
    })
    const [loading, setLoading] = useState(false)
    const [errors, setErrors] = useState({})
    const [showPassword, setShowPassword] = useState(false)
    const [showConfirmPassword, setShowConfirmPassword] = useState(false)

    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const positions = {
        general: {
            label: 'üë§ ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
            options: ['‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£/‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏£‡∏≤‡∏ä‡∏†‡∏±‡∏è‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°']
        },
        executives: {
            label: 'üë®‚Äçüíº ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£',
            options: [
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏£‡∏±‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'
            ]
        },
        officers: {
            label: 'üë®‚Äçüíª ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
            options: [
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 72 ‡∏û‡∏£‡∏£‡∏©‡∏≤',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏´‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ 80 ‡∏û‡∏£‡∏£‡∏©‡∏≤',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 34 ‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ 60 ‡∏õ‡∏µ',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏£‡∏±‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'
            ]
        }
    }

    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const departments = {
        faculties: {
            label: 'üéì ‡∏Ñ‡∏ì‡∏∞‡∏ï‡πà‡∏≤‡∏á‡πÜ',
            options: [
                '‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡∏Ñ‡∏ì‡∏∞‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                '‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                '‡∏Ñ‡∏ì‡∏∞‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£',
                '‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®',
                '‡∏Ñ‡∏ì‡∏∞‡∏£‡∏±‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø',
                '‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                '‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'
            ]
        },
        divisions: {
            label: 'üè¢ ‡∏Å‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡πà‡∏≤‡∏á‡πÜ',
            options: [
                '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏î‡∏µ',
                '‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á',
                '‡∏Å‡∏≠‡∏á‡∏Ñ‡∏•‡∏±‡∏á',
                '‡∏Å‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô',
                '‡∏Å‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•',
                '‡∏Å‡∏≠‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
                '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
                '‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°'
            ]
        },
        offices: {
            label: 'üìö ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÜ',
            options: [
                '‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ó‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®',
                '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°',
                '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô',
                '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£',
                '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û',
                '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏ó‡∏®‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏≤‡∏ô‡∏≤‡∏ä‡∏≤‡∏ï‡∏¥'
            ]
        },
        others: {
            label: 'üèõÔ∏è ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
            options: [
                '‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏£‡∏≤‡∏ä‡∏†‡∏±‡∏è‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°',
                '‡∏™‡∏†‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£',
                '‡∏™‡∏†‡∏≤‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏£‡∏≤‡∏ä‡∏†‡∏±‡∏è‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°',
                '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô'
            ]
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Address Selector
    const handleAddressChange = (addressData) => {
        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ controlled/uncontrolled input ‡πÇ‡∏î‡∏¢‡πÅ‡∏õ‡∏•‡∏á null ‡πÄ‡∏õ‡πá‡∏ô object ‡∏ó‡∏µ‡πà valid
        const safeAddressData = {
            province: addressData?.province || null,
            district: addressData?.district || null,
            subdistrict: addressData?.subdistrict || null
        }

        setFormData(prev => ({
            ...prev,
            address: safeAddressData
        }))
    }

    const handleSelectChange = (field, value) => {
        setFormData(prev => {
            const updated = { ...prev, [field]: value }

            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï role ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            if (field === 'position') {
                updated.role = determineRole(value)
            }

            return updated
        })

        // ‡∏•‡πâ‡∏≤‡∏á error ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß
        if (errors[field]) {
            setErrors(prev => ({
                ...prev,
                [field]: ''
            }))
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î role ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
    const determineRole = (position) => {
        if (!position) return 'user'

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (positions.executives.options.includes(position)) {
            return 'executive'
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (positions.officers.options.includes(position)) {
            return 'officer'
        }

        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô user
        return 'user'
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const validateForm = () => {
        const newErrors = {}

        if (!formData.first_name.trim()) newErrors.first_name = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠'
        if (!formData.last_name.trim()) newErrors.last_name = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        if (!formData.email.trim()) {
            newErrors.email = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•'
        } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
            newErrors.email = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        if (!formData.password) {
            newErrors.password = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô'
        } else if (formData.password.length < 8) {
            newErrors.password = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£'
        } else {
            const hasLetter = /[a-zA-Z]/.test(formData.password)
            const hasNumber = /[0-9]/.test(formData.password)
            if (!hasLetter || !hasNumber) {
                newErrors.password = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç'
            }
        }

        if (formData.password !== formData.confirmPassword) {
            newErrors.confirmPassword = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô'
        }

        if (!formData.citizen_id.trim()) {
            newErrors.citizen_id = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô'
        } else if (!/^\d{13}$/.test(formData.citizen_id)) {
            newErrors.citizen_id = '‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 13 ‡∏´‡∏•‡∏±‡∏Å'
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        if (formData.zip_code.trim()) {
            const zipCodeRegex = /^[0-9]{5}$/
            if (!zipCodeRegex.test(formData.zip_code)) {
                newErrors.zip_code = '‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 5 ‡∏´‡∏•‡∏±‡∏Å'
            }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
        if (!formData.position || formData.position === '') {
            newErrors.position = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
        if (!formData.department || formData.department === '') {
            newErrors.department = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î'
        }

        setErrors(newErrors)
        return Object.keys(newErrors).length === 0
    }

    const handleSubmit = async (e) => {
        e.preventDefault()

        if (!validateForm()) return

        setLoading(true)
        setErrors({})

        try {
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î role ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const finalRole = determineRole(formData.position)
            const submitData = {
                ...formData,
                role: finalRole,
                zip_code: formData.zip_code ? parseInt(formData.zip_code, 10) : null,
                // ‡πÅ‡∏õ‡∏•‡∏á address object ‡πÄ‡∏õ‡πá‡∏ô IDs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö database
                province_id: formData.address?.province?.province_id || null,
                district_id: formData.address?.district?.district_id || null,
                subdistrict_id: formData.address?.subdistrict?.subdistrict_id || null,
                // ‡∏•‡∏ö address object ‡∏≠‡∏≠‡∏Å
                address: undefined
            }

            const token = authUtils.getToken()
            const response = await fetch('http://localhost:8000/api/protected/admin/users', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(submitData)
            })

            const data = await response.json()

            if (response.ok && data.success) {
                // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡πÅ‡∏™‡∏î‡∏á success modal
                showSuccessModal()
                onSuccess()
                onClose()
            } else {
                if (data.error && data.error.includes('email')) {
                    setErrors({ email: '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß' })
                } else if (data.error && data.error.includes('citizen_id')) {
                    setErrors({ citizen_id: '‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß' })
                } else {
                    showErrorModal('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ')
                }
            }
        } catch (error) {
            console.error('Error adding user:', error)
            showErrorModal('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ')
        } finally {
            setLoading(false)
        }
    }

    const handleChange = (e) => {
        const { id, value } = e.target
        setFormData(prev => ({ ...prev, [id]: value }))

        // ‡∏•‡πâ‡∏≤‡∏á error ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        if (errors[id]) {
            setErrors(prev => ({ ...prev, [id]: '' }))
        }
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS animation styles
    if (typeof document !== 'undefined' && !document.querySelector('#modal-styles')) {
        const style = document.createElement('style')
        style.id = 'modal-styles'
        style.textContent = `
      @keyframes modal-bounce-in {
        0% {
          opacity: 0;
          transform: scale(0.3) translateY(30px);
        }
        50% {
          opacity: 1;
          transform: scale(1.05) translateY(-10px);
        }
        70% {
          transform: scale(0.98) translateY(2px);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .animate-modal-bounce-in {
        animation: modal-bounce-in 0.6s ease-out;
      }
      
      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .animate-fade-in {
        animation: fade-in 0.3s ease-out;
      }
      
      @keyframes fade-out {
        from { opacity: 1; }
        to { opacity: 0; }
      }
      
      @keyframes success-bounce {
        0% {
          opacity: 0;
          transform: scale(0.3) translateY(-50px);
        }
        40% {
          opacity: 1;
          transform: scale(1.1) translateY(10px);
        }
        60% {
          transform: scale(0.95) translateY(-5px);
        }
        80% {
          transform: scale(1.02) translateY(2px);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .animate-success-bounce {
        animation: success-bounce 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      
      .animate-check-icon {
        animation: check-icon 0.8s ease-out 0.2s both;
      }
      
      .animate-check-draw {
        animation: check-draw 0.5s ease-out 0.4s both;
      }
      
      @keyframes check-icon {
        0% {
          opacity: 0;
          transform: scale(0) rotate(-180deg);
        }
        50% {
          opacity: 1;
          transform: scale(1.2) rotate(-90deg);
        }
        100% {
          opacity: 1;
          transform: scale(1) rotate(0deg);
        }
      }
      
      @keyframes check-draw {
        0% {
          stroke-dasharray: 0 50;
          opacity: 0;
        }
        50% {
          stroke-dasharray: 25 50;
          opacity: 0.8;
        }
        100% {
          stroke-dasharray: 50 50;
          opacity: 1;
        }
      }
      
      .animate-fade-up-text {
        animation: fade-up-text 0.5s ease-out 0.6s both;
      }
      
      .animate-fade-up-button {
        animation: fade-up-button 0.5s ease-out 0.8s both;
      }
      
      @keyframes fade-up-text {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes fade-up-button {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes error-shake {
        0% {
          opacity: 0;
          transform: translateX(-50px);
        }
        15% {
          transform: translateX(25px);
        }
        30% {
          transform: translateX(-20px);
        }
        45% {
          transform: translateX(15px);
        }
        60% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(5px);
        }
        100% {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .animate-error-shake {
        animation: error-shake 0.6s ease-out;
      }
    `
        document.head.appendChild(style)
    }

    return (
        <div
            className={`fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4 transition-all duration-300 ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
            onClick={onClose}
        >
            <div
                className={`bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden ${isOpen ? 'animate-modal-bounce-in' : ''}`}
                onClick={(e) => e.stopPropagation()}
            >
                {/* Header */}
                <div className="sticky top-0 bg-gradient-to-r from-orange-500 via-amber-500 to-yellow-500 px-8 py-6 z-10 shadow-lg">
                    <div className="flex items-center justify-between">
                        <div>
                            <h3 className="text-3xl font-bold text-white flex items-center">
                                <span className="bg-white/20 rounded-xl p-2 mr-3">üë•</span>
                                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
                            </h3>
                            <p className="text-orange-100 text-base mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö - ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏£‡∏≤‡∏ä‡∏†‡∏±‡∏è‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°</p>
                        </div>
                        <button
                            onClick={onClose}
                            className="text-orange-100 hover:text-white transition-all duration-200 bg-white/20 hover:bg-white/30 rounded-full p-3 hover:scale-110"
                        >
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                {/* Content Container with better scroll */}
                <div className="overflow-y-auto max-h-[calc(95vh-120px)]" style={{ scrollbarWidth: 'thin' }}>

                    <form onSubmit={handleSubmit} className="p-8">
                        <div className="space-y-8">
                            {/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß */}
                            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200">
                                <h4 className="text-xl font-bold mb-6 text-gray-800 flex items-center">
                                    <span className="bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl w-10 h-10 flex items-center justify-center mr-3 shadow-lg">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </span>
                                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
                                </h4>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="space-y-3">
                                        <label htmlFor="first_name" className="text-gray-700 font-semibold text-base">
                                            ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á <span className="text-red-500">*</span>
                                        </label>
                                        <input
                                            id="first_name"
                                            type="text"
                                            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á"
                                            value={formData.first_name}
                                            onChange={handleChange}
                                            disabled={loading}
                                            className={`w-full border rounded-lg px-4 py-2.5 text-sm text-gray-900 font-medium placeholder:text-gray-500 focus:ring-2 transition-all duration-200 bg-white ${errors.first_name ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-indigo-400 focus:border-indigo-500 focus:ring-indigo-200'
                                                }`}
                                        />
                                        {errors.first_name && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.first_name}
                                            </p>
                                        )}
                                    </div>

                                    <div className="space-y-3">
                                        <label htmlFor="last_name" className="text-gray-700 font-semibold text-base">
                                            ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span className="text-red-500">*</span>
                                        </label>
                                        <input
                                            id="last_name"
                                            type="text"
                                            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
                                            value={formData.last_name}
                                            onChange={handleChange}
                                            disabled={loading}
                                            className={`w-full border rounded-lg px-4 py-2.5 text-sm text-gray-900 font-medium placeholder:text-gray-500 focus:ring-2 transition-all duration-200 bg-white ${errors.last_name ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-indigo-400 focus:border-indigo-500 focus:ring-indigo-200'
                                                }`}
                                        />
                                        {errors.last_name && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.last_name}
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* ‡∏≠‡∏µ‡πÄ‡∏°‡∏• */}
                                <div className="mt-6">
                                    <div className="space-y-3">
                                        <label htmlFor="email" className="text-gray-700 font-semibold text-base">
                                            ‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span className="text-red-500">*</span>
                                        </label>
                                        <input
                                            id="email"
                                            type="email"
                                            placeholder="example@email.com"
                                            value={formData.email}
                                            onChange={handleChange}
                                            disabled={loading}
                                            className={`w-full border rounded-lg px-4 py-2.5 text-sm text-gray-900 font-medium placeholder:text-gray-500 focus:ring-2 transition-all duration-200 bg-white ${errors.email ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-indigo-400 focus:border-indigo-500 focus:ring-indigo-200'
                                                }`}
                                        />
                                        {errors.email && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.email}
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                                    <div className="space-y-3">
                                        <label htmlFor="password" className="text-gray-700 font-semibold text-base">
                                            ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span className="text-red-500">*</span>
                                        </label>
                                        <div className="relative">
                                            <input
                                                id="password"
                                                type={showPassword ? 'text' : 'password'}
                                                placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£"
                                                value={formData.password}
                                                onChange={handleChange}
                                                disabled={loading}
                                                className={`w-full border rounded-lg px-4 py-2.5 pr-12 text-sm text-gray-900 font-medium placeholder:text-gray-500 focus:ring-2 transition-all duration-200 bg-white ${errors.password ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-indigo-400 focus:border-indigo-500 focus:ring-indigo-200'
                                                    }`}
                                            />
                                            <button
                                                type="button"
                                                onClick={() => setShowPassword(!showPassword)}
                                                className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-indigo-600 focus:text-indigo-600 transition-all duration-200"
                                            >
                                                {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
                                            </button>
                                        </div>
                                        {errors.password && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.password}
                                            </p>
                                        )}
                                    </div>

                                    <div className="space-y-3">
                                        <label htmlFor="confirmPassword" className="text-gray-700 font-semibold text-base">
                                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span className="text-red-500">*</span>
                                        </label>
                                        <div className="relative">
                                            <input
                                                id="confirmPassword"
                                                type={showConfirmPassword ? 'text' : 'password'}
                                                placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
                                                value={formData.confirmPassword}
                                                onChange={handleChange}
                                                disabled={loading}
                                                className={`w-full border rounded-lg px-4 py-2.5 pr-12 text-sm text-gray-900 font-medium placeholder:text-gray-500 focus:ring-2 transition-all duration-200 bg-white ${errors.confirmPassword ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-indigo-400 focus:border-indigo-500 focus:ring-indigo-200'
                                                    }`}
                                            />
                                            <button
                                                type="button"
                                                onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                                                className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-indigo-600 focus:text-indigo-600 transition-all duration-200"
                                            >
                                                {showConfirmPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
                                            </button>
                                        </div>
                                        {errors.confirmPassword && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.confirmPassword}
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô */}
                                <div className="mt-6">
                                    <div className="space-y-3">
                                        <label htmlFor="citizen_id" className="text-gray-700 font-semibold text-base">
                                            ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô <span className="text-red-500">*</span>
                                        </label>
                                        <input
                                            id="citizen_id"
                                            type="text"
                                            placeholder="1234567890123"
                                            pattern="[0-9]{13}"
                                            maxLength="13"
                                            value={formData.citizen_id}
                                            onChange={handleChange}
                                            disabled={loading}
                                            className={`w-full border rounded-lg px-4 py-2.5 text-sm text-gray-900 font-medium placeholder:text-gray-500 focus:ring-2 transition-all duration-200 bg-white ${errors.citizen_id ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-indigo-400 focus:border-indigo-500 focus:ring-indigo-200'
                                                }`}
                                        />
                                        {errors.citizen_id && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.citizen_id}
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) */}
                                {formData.position && (
                                    <div className="mt-6">
                                        <div className="space-y-3">
                                            <label className="text-gray-700 font-semibold text-base">
                                                ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô <span className="text-red-500">*</span>
                                            </label>
                                            <div className="w-full border-2 rounded-xl px-5 py-4 text-lg font-bold bg-gradient-to-r from-indigo-50 to-purple-50 border-indigo-200 text-gray-800 shadow-sm">
                                                <div className="flex items-center">
                                                    <span className="flex-1">
                                                        {determineRole(formData.position) === 'user' && 'üë§ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}
                                                        {determineRole(formData.position) === 'officer' && 'üë®‚Äçüíª ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà'}
                                                        {determineRole(formData.position) === 'executive' && 'üë®‚Äçüíº ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£'}
                                                    </span>
                                                    <span className="text-sm text-indigo-600 bg-white/60 px-2 py-1 rounded-lg">(‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà */}
                            <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-200">
                                <h4 className="text-xl font-bold mb-6 text-gray-800 flex items-center">
                                    <span className="bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl w-10 h-10 flex items-center justify-center mr-3 shadow-lg">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                    </span>
                                    ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
                                </h4>

                                <div className="grid grid-cols-1 gap-6">
                                    <AddressSelector
                                        value={formData.address || { province: null, district: null, subdistrict: null }}
                                        onChange={handleAddressChange}
                                        onZipCodeChange={(zipCode) => {
                                            setFormData(prev => ({ ...prev, zip_code: zipCode || '' }))
                                        }}
                                        disabled={loading}
                                        className="w-full"
                                    />

                                    {/* ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå */}
                                    <div className="space-y-3">
                                        <label htmlFor="zip_code" className="text-gray-700 font-semibold text-base">
                                            ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå
                                        </label>
                                        <input
                                            id="zip_code"
                                            type="text"
                                            placeholder="‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•"
                                            pattern="[0-9]{5}"
                                            maxLength="5"
                                            value={formData.zip_code}
                                            onChange={handleChange}
                                            disabled={loading}
                                            readOnly
                                            className={`w-full border rounded-lg px-4 py-2.5 text-sm text-gray-900 font-medium placeholder:text-gray-500 focus:ring-2 transition-all duration-200 bg-gray-50 ${errors.zip_code ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-green-400 focus:border-green-500 focus:ring-green-200'
                                                }`}
                                        />
                                        {errors.zip_code && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.zip_code}
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô */}
                            <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border border-purple-200">
                                <h4 className="text-xl font-bold mb-6 text-gray-800 flex items-center">
                                    <span className="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl w-10 h-10 flex items-center justify-center mr-3 shadow-lg">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                        </svg>
                                    </span>
                                    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                                </h4>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="space-y-3">
                                        <label htmlFor="position" className="text-gray-700 font-semibold text-base">
                                            ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span className="text-red-500">*</span>
                                        </label>
                                        <select
                                            id="position"
                                            value={formData.position}
                                            onChange={(e) => handleSelectChange('position', e.target.value)}
                                            disabled={loading}
                                            className={`w-full border rounded-lg px-4 py-2.5 text-sm text-gray-900 font-medium focus:ring-2 transition-all duration-200 bg-white ${errors.position ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-purple-400 focus:border-purple-500 focus:ring-purple-200'
                                                }`}
                                        >
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</option>

                                            {/* ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */}
                                            <optgroup label="üë§ ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">
                                                {positions.general.options.map((position, index) => (
                                                    <option key={`general-${index}`} value={position}>
                                                        {position}
                                                    </option>
                                                ))}
                                            </optgroup>

                                            {/* ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ */}
                                            <optgroup label="üë®‚Äçüíº ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£">
                                                {positions.executives.options.map((position, index) => (
                                                    <option key={`executives-${index}`} value={position}>
                                                        {position}
                                                    </option>
                                                ))}
                                            </optgroup>

                                            {/* ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà */}
                                            <optgroup label="üë®‚Äçüíª ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°">
                                                {positions.officers.options.map((position, index) => (
                                                    <option key={`officers-${index}`} value={position}>
                                                        {position}
                                                    </option>
                                                ))}
                                            </optgroup>
                                        </select>
                                        {errors.position && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.position}
                                            </p>
                                        )}
                                    </div>

                                    <div className="space-y-3">
                                        <label htmlFor="department" className="text-gray-700 font-semibold text-base">
                                            ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î <span className="text-red-500">*</span>
                                        </label>
                                        <select
                                            id="department"
                                            value={formData.department}
                                            onChange={(e) => handleSelectChange('department', e.target.value)}
                                            disabled={loading}
                                            className={`w-full border rounded-lg px-4 py-2.5 text-sm text-gray-900 font-medium focus:ring-2 transition-all duration-200 bg-white ${errors.department ? 'border-red-400 focus:border-red-500 focus:ring-red-200' : 'border-gray-300 hover:border-purple-400 focus:border-purple-500 focus:ring-purple-200'
                                                }`}
                                        >
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</option>

                                            {/* ‡∏Ñ‡∏ì‡∏∞‡∏ï‡πà‡∏≤‡∏á‡πÜ */}
                                            <optgroup label="üéì ‡∏Ñ‡∏ì‡∏∞‡∏ï‡πà‡∏≤‡∏á‡πÜ">
                                                {departments.faculties.options.map((dept, index) => (
                                                    <option key={`faculties-${index}`} value={dept}>
                                                        {dept}
                                                    </option>
                                                ))}
                                            </optgroup>

                                            {/* ‡∏Å‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡πà‡∏≤‡∏á‡πÜ */}
                                            <optgroup label="üè¢ ‡∏Å‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ï‡πà‡∏≤‡∏á‡πÜ">
                                                {departments.divisions.options.map((dept, index) => (
                                                    <option key={`divisions-${index}`} value={dept}>
                                                        {dept}
                                                    </option>
                                                ))}
                                            </optgroup>

                                            {/* ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÜ */}
                                            <optgroup label="üìö ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÜ">
                                                {departments.offices.options.map((dept, index) => (
                                                    <option key={`offices-${index}`} value={dept}>
                                                        {dept}
                                                    </option>
                                                ))}
                                            </optgroup>

                                            {/* ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ */}
                                            <optgroup label="üèõÔ∏è ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ">
                                                {departments.others.options.map((dept, index) => (
                                                    <option key={`others-${index}`} value={dept}>
                                                        {dept}
                                                    </option>
                                                ))}
                                            </optgroup>
                                        </select>
                                        {errors.department && (
                                            <p className="text-red-500 text-sm mt-1 flex items-center">
                                                <span className="mr-1">‚ö†Ô∏è</span>
                                                {errors.department}
                                            </p>
                                        )}
                                    </div>
                                </div>

                            </div>
                        </div>

                        {/* Submit Button */}
                        <div className="flex flex-col items-center space-y-4 mt-8 pt-6 border-t border-gray-200 bg-gray-50/50 -mx-8 px-8 pb-8 mb-4">
                            <div className="flex gap-3 w-full max-w-sm mt-2">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 py-3 border-2 border-gray-300 rounded-lg text-gray-700 font-semibold hover:bg-white hover:border-gray-400 hover:shadow-md transition-all duration-200 text-sm shadow-sm bg-white"
                                    disabled={loading}
                                >
                                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 bg-gradient-to-r from-orange-500 via-amber-500 to-yellow-500 hover:from-orange-600 hover:via-amber-600 hover:to-yellow-600 text-white py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none text-sm border border-orange-400"
                                    disabled={loading}
                                >
                                    {loading ? (
                                        <span className="flex items-center justify-center">
                                            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...
                                        </span>
                                    ) : (
                                        <span className="flex items-center justify-center">
                                            <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                            </svg>
                                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
                                        </span>
                                    )}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    )
}